from flask import Flask, request, session, render_templatefrom flask_pymongo import PyMongofrom bson import json_utilimport jsonfrom flask.json import jsonifyfrom templates import *# from bson.json_util import dumpsapp = Flask(__name__)app.secret_key = keyapp.config['MONGO_HOST'] = IPapp.config['MONGO_PORT'] = PORTapp.config['MONGO_DBNAME'] = DBapp.config['MONGO_USERNAME'] = USERapp.config['MONGO_PASSWORD'] = PASSWORDmongo = PyMongo(app)JSON_RESULT = []@app.route("/")@app.route("/home_page")def home_page():    return render_template('/index.html')@app.route('/search', methods=['POST'])  def  search():    drug_name = request.form['name']    session['drug_name'] = drug_name    # Calling functions to get data from other files    print 'hello'    RxNorm = getRxterms(drug_name)    getNdfrt_data(RxNorm)          Primaryid = getFDA_Tot_data(drug_name)     getFDA_data(Primaryid)         global JSON_RESULT    return (jsonify(Result=JSON_RESULT))def getRxterms(drugName):    """        This function accesses the RxTerms201408.txt to retreives the related RxIngredients.    """    rxTerms = mongo.db.RxTerms.find({ "$and": [ {'DISPLAY_NAME':{'$regex':drugName, '$options' : 'i'}}, {'IS_RETIRED':{"$ne":"TRUE"}} ] })     rxTerms_json = []    for item in rxTerms:        rxTerms_json.append(json.loads(json_util.dumps(item)))      if (len(rxTerms_json) >= 1):        global JSON_RESULT        JSON_RESULT.append(rxTerms_json)    RxNormcui = []        print rxTerms_json    for val in rxTerms_json:        try:            RxNormcui.append(val['ING_RXCUI'])        except KeyError:            z=1    return RxNormcui    def getFDA_Tot_data(drugName):    """    This function extracts data from FDA_Tot collection           """    drugname = session['drug_name']    FDA = mongo.db.FDA_Tot.find({'DRUGNAME':{'$regex':drugname, '$options' : 'i'}}, {'_id':0})    FDA_json = []    for item in FDA:        FDA_json.append(json.loads(json_util.dumps(item)))        primaryid = []    for val in FDA_json:        primaryid.append(val['PRIMARY_ID'])        if (len(FDA_json) >= 1):        global JSON_RESULT        JSON_RESULT.append(FDA_json)        # print (JSON_RESULT)            return primaryid   '''Getting all the data from OUTC,REAC,RSPR,DEMO files which are embedded and stored in FDA collection'''    def getFDA_data(primary_id):    FDA_Tot_json = []        for item in primary_id:        demofile = mongo.db.FDA.find({'PRIMARY_ID':int(item)}, {'_id':0})            for items in demofile:            FDA_Tot_json.append(json.loads(json_util.dumps(items)))            if (len(FDA_Tot_json) >= 1):        global JSON_RESULT        JSON_RESULT.append(FDA_Tot_json)   def getNdfrt_data(RxNormcui):    """        To find data from NDFRT XML file based on RxNorm_CUI from RXINGREDIENTS file.    """    RxNormcui_json = []    for item in RxNormcui:        RxNorm_cui = mongo.db.XML.find({'RxNorm_CUI':str(item)}, {'_id':0})                for items1 in RxNorm_cui:            print items1            RxNormcui_json.append(json.loads(json_util.dumps(items1)))           if (len(RxNormcui_json) >= 1):        global JSON_RESULT        JSON_RESULT.append(RxNormcui_json)    if __name__ == "__main__":    app.run(debug=True)